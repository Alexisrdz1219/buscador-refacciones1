<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Importar desde Odoo</title>
</head>
<body>

<input type="file" id="excel" />
<button onclick="importar()">Importar Odoo</button>


<div style="margin-top:10px; width:300px; background:#ddd; height:20px;">
  <div id="barra" style="height:100%; width:0%; background:#4caf50;"></div>
</div>

<p id="estado"></p>
<div id="duplicados"></div>



<script>
const API = "https://buscador-refaccionesbackend.onrender.com";

function importar() {
  const file = document.getElementById("excel").files[0];
  const barra = document.getElementById("barra");
  const estado = document.getElementById("estado");

  if (!file) {
    alert("Selecciona un archivo");
    return;
  }

  const formData = new FormData();
  formData.append("file", file);

  const xhr = new XMLHttpRequest();

  xhr.open("POST", `${API}/importar-odoo`);

  xhr.upload.onprogress = function (e) {
    if (e.lengthComputable) {
      const percent = Math.round((e.loaded / e.total) * 100);
      barra.style.width = percent + "%";
      estado.textContent = `Subiendo archivo: ${percent}%`;
    }
  };

  xhr.onload = function () {
  if (xhr.status === 200) {
    const data = JSON.parse(xhr.responseText);

    estado.textContent =
      `‚úÖ Insertados: ${data.insertados} | üîÅ Duplicados: ${data.duplicados.length}`;

    barra.style.width = "100%";

    if (data.duplicados.length > 0) {
      let html = "<h3>‚ö†Ô∏è Refacciones duplicadas</h3><ul>";

      data.duplicados.forEach(d => {
        html += `<li><b>${d.refInterna}</b> - ${d.nombre}</li>`;
      });

      html += "</ul>";
      document.getElementById("duplicados").innerHTML = html;
    }
  } else {
    estado.textContent = "‚ùå Error al importar";
  }
};


  xhr.onerror = function () {
    estado.textContent = "‚ùå Error de conexi√≥n";
  };

  xhr.send(formData);
}
</script>


</body>
</html>
